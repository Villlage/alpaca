{"ast":null,"code":"import _regeneratorRuntime from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useLayoutEffect,useState}from'react';import'./style.scss';import Icon from'../../../../../components/Icon';import Message from'../../../../../components/Message';import PageContent from'../../../../../modules/common/PageContent';import SubscriptionOffer from'../../../../../modules/company/SubscriptionOffer';import{OFFERS}from'../../../../../../constants/mockData';import Loader from'../../../../../components/Loader';import PlaidService from'../../../../../../services/plaid.service';import Tabs from'../../../../../components/Tabs';import Button from'../../../../../components/Button';import UserService from'../../../../../../services/user.service';import{fixClass}from'../../../../../../helpers/base';var plaidService=new PlaidService();var userService=new UserService();export default function BillingAndSubs(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),request_error=_useState2[0],set_request_error=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),mask=_useState4[0],set_mask=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],set_loading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),btn_loading=_useState8[0],set_btn_loading=_useState8[1];var _useState9=useState('subscription'),_useState10=_slicedToArray(_useState9,2),active_tab=_useState10[0],set_active_tab=_useState10[1];var companyId=props.currentUser.company;var getMask=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return plaidService.getMask(companyId);case 3:res=_context.sent;set_loading(false);if(!(res&&res.error||res.err_msg)){_context.next=9;break;}set_request_error(res.error||res.err_msg);set_mask(null);return _context.abrupt(\"return\",setTimeout(function(){return set_request_error('');},3000));case 9:_context.next=17;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);set_mask(null);set_request_error(_context.t0.error||_context.t0.toString());set_loading(false);setTimeout(function(){return set_request_error('');},3000);case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function getMask(){return _ref.apply(this,arguments);};}();var cancel_subscription=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;set_btn_loading(true);_context2.next=4;return userService.editUser({is_active:!props.currentUser.is_active});case 4:res=_context2.sent;if(!(res&&res.error||res.err_msg)){_context2.next=8;break;}set_request_error(res.error||res.err_msg);return _context2.abrupt(\"return\",setTimeout(function(){return set_request_error('');},3000));case 8:props.setCurrentUser(res);set_btn_loading(false);_context2.next=17;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);set_btn_loading(false);set_request_error(_context2.t0.error||_context2.t0.toString());setTimeout(function(){return set_request_error('');},3000);case 17:case\"end\":return _context2.stop();}}},_callee2,null,[[0,12]]);}));return function cancel_subscription(){return _ref2.apply(this,arguments);};}();var tab_strategy={subscription:/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"tab\"},/*#__PURE__*/React.createElement(\"h2\",{className:\"tab-title\"},\"My Subscription\"),/*#__PURE__*/React.createElement(\"div\",{className:\"offer-list\"},OFFERS.map(function(offer,i){return/*#__PURE__*/React.createElement(SubscriptionOffer,{offer:offer,key:i});})),/*#__PURE__*/React.createElement(\"div\",{className:\"payment-method\"},/*#__PURE__*/React.createElement(\"h2\",null,\"Payment method\"),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",null,mask?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icon,{icon:\"check-circle\"}),\"Account ending in \",mask):'')))),/*#__PURE__*/React.createElement(\"footer\",null,/*#__PURE__*/React.createElement(Button,{onClick:cancel_subscription,loading:btn_loading,className:fixClass(props.currentUser.is_active&&'active')},props.currentUser.is_active?'Cancel Subscription':'Activate Subscription'))),billing:'',invoices:/*#__PURE__*/React.createElement(\"section\",{className:\"tab\"},/*#__PURE__*/React.createElement(\"h2\",{className:\"tab-title\"},\"Invoices\"))};useLayoutEffect(function(){companyId?getMask():set_loading(false);},[]);return loading?/*#__PURE__*/React.createElement(Loader,null):/*#__PURE__*/React.createElement(\"article\",{className:\"BillingAndSubs-page\"},/*#__PURE__*/React.createElement(PageContent,{title:\"Billing and Subscription\"},/*#__PURE__*/React.createElement(\"section\",{className:\"billing-info\"},/*#__PURE__*/React.createElement(\"header\",null,/*#__PURE__*/React.createElement(Tabs,{tabs:['subscription','billing','invoices'],onChange:function onChange(tab){return set_active_tab(tab);},activeTab:active_tab})),tab_strategy[active_tab]),/*#__PURE__*/React.createElement(Message,{message:request_error})));}/*\n\nconst table_headers: Header[] = [\n  {\n    key: 'date',\n    title: 'DATE',\n    sortable: true,\n  },\n  {\n    key: 'invoice_number',\n    title: 'Invoice Number',\n    sortable: true,\n  },\n  {\n    key: 'billing_period',\n    title: 'Billing\\n' + 'Period',\n    sortable: true,\n\n  },\n  {\n    key: 'amount',\n    title: 'Amount',\n    sortable: true,\n  },\n  {\n    key: 'status',\n    title: 'Status',\n    sortable: true,\n  },\n]\n */","map":{"version":3,"sources":["/Users/gilad/code/commitmuse/client/src/app/pages/public/company/dashboard/billing-and-subs/index.tsx"],"names":["React","useLayoutEffect","useState","Icon","Message","PageContent","SubscriptionOffer","OFFERS","Loader","PlaidService","Tabs","Button","UserService","fixClass","plaidService","userService","BillingAndSubs","props","request_error","set_request_error","mask","set_mask","loading","set_loading","btn_loading","set_btn_loading","active_tab","set_active_tab","companyId","currentUser","company","getMask","res","error","err_msg","setTimeout","toString","cancel_subscription","editUser","is_active","setCurrentUser","tab_strategy","subscription","map","offer","i","billing","invoices","tab"],"mappings":"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","sourcesContent":["import React, { useLayoutEffect, useState } from 'react'\nimport './style.scss'\nimport { ScreenProps } from '../../../../../../interfaces/baseIntefaces'\nimport Icon from '../../../../../components/Icon'\nimport Message from '../../../../../components/Message'\nimport PageContent from '../../../../../modules/common/PageContent'\nimport SubscriptionOffer from '../../../../../modules/company/SubscriptionOffer'\nimport { OFFERS } from '../../../../../../constants/mockData'\nimport Loader from '../../../../../components/Loader'\nimport PlaidService from '../../../../../../services/plaid.service'\nimport Tabs from '../../../../../components/Tabs'\nimport Button from '../../../../../components/Button'\nimport UserService from '../../../../../../services/user.service'\nimport { fixClass } from '../../../../../../helpers/base'\n\nconst plaidService = new PlaidService()\nconst userService = new UserService()\n\ninterface BillingAndSubsProps extends ScreenProps {}\n\nexport default function BillingAndSubs(props: BillingAndSubsProps) {\n  const [request_error, set_request_error] = useState<any>('')\n  const [mask, set_mask] = useState<string | null>('')\n  const [loading, set_loading] = useState<boolean>(true)\n  const [btn_loading, set_btn_loading] = useState<boolean>(false)\n  const [active_tab, set_active_tab] = useState<string>('subscription')\n\n  const companyId = props.currentUser.company\n\n  const getMask = async () => {\n    try {\n      const res = await plaidService.getMask(companyId)\n\n      set_loading(false)\n\n      if ((res && res.error) || res.err_msg) {\n        set_request_error(res.error || res.err_msg)\n        set_mask(null)\n        return setTimeout(() => set_request_error(''), 3000)\n      }\n    } catch (e) {\n      set_mask(null)\n      set_request_error(e.error || e.toString())\n      set_loading(false)\n      setTimeout(() => set_request_error(''), 3000)\n    }\n  }\n\n  const cancel_subscription = async () => {\n    try {\n      set_btn_loading(true)\n      const res = await userService.editUser({ is_active: !props.currentUser.is_active })\n\n      if ((res && res.error) || res.err_msg) {\n        set_request_error(res.error || res.err_msg)\n        return setTimeout(() => set_request_error(''), 3000)\n      }\n\n      props.setCurrentUser(res)\n      set_btn_loading(false)\n    } catch (e) {\n      set_btn_loading(false)\n      set_request_error(e.error || e.toString())\n      setTimeout(() => set_request_error(''), 3000)\n    }\n  }\n\n  const tab_strategy: any = {\n    subscription: (\n      <>\n        <div className=\"tab\">\n          <h2 className=\"tab-title\">My Subscription</h2>\n          <div className=\"offer-list\">\n            {OFFERS.map((offer, i) => (\n              <SubscriptionOffer offer={offer} key={i} />\n            ))}\n          </div>\n          <div className=\"payment-method\">\n            <h2>Payment method</h2>\n            <div>\n              <p>\n                {mask ? (\n                  <>\n                    <Icon icon=\"check-circle\" />\n                    Account ending in {mask}\n                  </>\n                ) : (\n                  ''\n                )}\n              </p>\n            </div>\n          </div>\n        </div>\n        <footer>\n          <Button\n            onClick={cancel_subscription}\n            loading={btn_loading}\n            className={fixClass(props.currentUser.is_active && 'active')}\n          >\n            {props.currentUser.is_active ? 'Cancel Subscription' : 'Activate Subscription'}\n          </Button>\n        </footer>\n      </>\n    ),\n    billing: '',\n    invoices: (\n      <section className=\"tab\">\n        <h2 className=\"tab-title\">Invoices</h2>\n        {/*<Table rows={INVOICES} headers={table_headers} />*/}\n      </section>\n    ),\n  }\n\n  useLayoutEffect(() => {\n    companyId ? getMask() : set_loading(false)\n  }, [])\n\n  return loading ? (\n    <Loader />\n  ) : (\n    <article className=\"BillingAndSubs-page\">\n      <PageContent title=\"Billing and Subscription\">\n        <section className=\"billing-info\">\n          <header>\n            <Tabs\n              tabs={['subscription', 'billing', 'invoices']}\n              onChange={tab => set_active_tab(tab)}\n              activeTab={active_tab}\n            />\n          </header>\n          {tab_strategy[active_tab]}\n        </section>\n\n        <Message message={request_error} />\n      </PageContent>\n    </article>\n  )\n}\n\n/*\n\nconst table_headers: Header[] = [\n  {\n    key: 'date',\n    title: 'DATE',\n    sortable: true,\n  },\n  {\n    key: 'invoice_number',\n    title: 'Invoice Number',\n    sortable: true,\n  },\n  {\n    key: 'billing_period',\n    title: 'Billing\\n' + 'Period',\n    sortable: true,\n\n  },\n  {\n    key: 'amount',\n    title: 'Amount',\n    sortable: true,\n  },\n  {\n    key: 'status',\n    title: 'Status',\n    sortable: true,\n  },\n]\n */\n"]},"metadata":{},"sourceType":"module"}