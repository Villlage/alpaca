{"ast":null,"code":"import _regeneratorRuntime from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useLayoutEffect,useState}from'react';import'./style.scss';import PageHeader from'../../../../../modules/common/PageHeader';import PageContent from'../../../../../modules/common/PageContent';import FAQ from'../../../../../modules/company/CreateIsa/FAQ';import IsaOfferReview from'../../../../../modules/client/IsaOfferReview';import OfferStatus from'../../../../../modules/client/OfferStatus';import ClientIsaSignUp from'../sign-up';import{usePlaidLink}from'react-plaid-link';import PlaidService from'../../../../../../services/plaid.service';import Message from'../../../../../components/Message';import Button from'../../../../../components/Button';import ClientService from'../../../../../../services/client.service';var plaidService=new PlaidService();var clientService=new ClientService();var offerStatuses=['review offer','sign up','link bank','sign contract'];export default function ClientIsaOffer(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),isa=_useState2[0],set_isa=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),offer_step=_useState4[0],set_offer_step=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),request_error=_useState6[0],set_request_error=_useState6[1];var isa_id=props.match.params.id;var getIsa=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return clientService.getOffer(isa_id);case 3:res=_context.sent;if(res){if(res.error){set_offer_step(offer_step-1);set_request_error(res.error);setTimeout(function(){return set_request_error('');},3000);}else{set_isa(res);}}_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);set_request_error(_context.t0.error||_context.t0.toString());setTimeout(function(){return set_request_error('');},3000);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function getIsa(){return _ref.apply(this,arguments);};}();useLayoutEffect(function(){getIsa();},[]);var onSuccess=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(token,metadata){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return plaidService.createItem(token,metadata);case 3:res=_context2.sent;if(res){if(res.error||res.err_msg){set_offer_step(offer_step-1);set_request_error(res.error||res.err_msg);setTimeout(function(){return set_request_error('');},3000);}else{props.history.push(\"/isa/\".concat(isa_id||1));}}_context2.next=12;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);set_offer_step(offer_step-1);set_request_error(_context2.t0.error||_context2.t0.toString());setTimeout(function(){return set_request_error('');},3000);case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function onSuccess(_x,_x2){return _ref2.apply(this,arguments);};}();var handleSignUp=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:set_offer_step(offer_step+1);_context3.next=3;return props.fetchUser();case 3:open();case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSignUp(){return _ref3.apply(this,arguments);};}();var config={clientName:'Commit Muse',env:'sandbox',product:['auth','transactions'],publicKey:'a004a070f0629da694fbae916414f3',onSuccess:onSuccess};var _usePlaidLink=usePlaidLink(config),open=_usePlaidLink.open,ready=_usePlaidLink.ready,error=_usePlaidLink.error;var offer_strategy=isa&&{'review offer':/*#__PURE__*/React.createElement(IsaOfferReview,{isa:isa,onNext:function onNext(){set_offer_step(offer_step+1);}}),'sign up':isa&&/*#__PURE__*/React.createElement(ClientIsaSignUp,{email:isa.student.email,user_id:isa.student.id.toString(),onNext:handleSignUp}),'link bank':/*#__PURE__*/React.createElement(\"section\",{className:\"link_bank\"},/*#__PURE__*/React.createElement(Button,{background:\"MainWarning\",onClick:function onClick(){return open();}},\"Link Bank\"))};return/*#__PURE__*/React.createElement(\"article\",{className:\"ClientIsaOffer-page\"},/*#__PURE__*/React.createElement(PageHeader,null),/*#__PURE__*/React.createElement(PageContent,null,/*#__PURE__*/React.createElement(\"section\",{className:\"offer-steps\"},/*#__PURE__*/React.createElement(OfferStatus,{statuses:offerStatuses,activeIndex:offer_step}),isa&&offer_strategy[offerStatuses[offer_step]]),isa&&/*#__PURE__*/React.createElement(FAQ,{maximum:isa.cap,months:isa.time_to_be_paid,percentage:isa.percentage,current_income:isa.current_income})),/*#__PURE__*/React.createElement(Message,{message:request_error}));}","map":{"version":3,"sources":["/Users/gilad/code/commitmuse/client/src/app/pages/public/client/isa-offer-steps/review/index.tsx"],"names":["React","useLayoutEffect","useState","PageHeader","PageContent","FAQ","IsaOfferReview","OfferStatus","ClientIsaSignUp","usePlaidLink","PlaidService","Message","Button","ClientService","plaidService","clientService","offerStatuses","ClientIsaOffer","props","isa","set_isa","offer_step","set_offer_step","request_error","set_request_error","isa_id","match","params","id","getIsa","getOffer","res","error","setTimeout","toString","onSuccess","token","metadata","createItem","err_msg","history","push","handleSignUp","fetchUser","open","config","clientName","env","product","publicKey","ready","offer_strategy","student","email","cap","time_to_be_paid","percentage","current_income"],"mappings":"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","sourcesContent":["import React, { useLayoutEffect, useState } from 'react'\nimport './style.scss'\nimport { PlaidMetadata, ScreenProps } from '../../../../../../interfaces/baseIntefaces'\nimport PageHeader from '../../../../../modules/common/PageHeader'\nimport PageContent from '../../../../../modules/common/PageContent'\nimport FAQ from '../../../../../modules/company/CreateIsa/FAQ'\nimport IsaOfferReview from '../../../../../modules/client/IsaOfferReview'\nimport OfferStatus from '../../../../../modules/client/OfferStatus'\nimport ClientIsaSignUp from '../sign-up'\nimport { usePlaidLink } from 'react-plaid-link'\nimport PlaidService from '../../../../../../services/plaid.service'\nimport Message from '../../../../../components/Message'\nimport Button from '../../../../../components/Button'\nimport ClientService from '../../../../../../services/client.service'\n\nconst plaidService = new PlaidService()\nconst clientService = new ClientService()\nconst offerStatuses = ['review offer', 'sign up', 'link bank', 'sign contract']\n\ninterface ClientIsaOfferProps extends ScreenProps {\n  match: any\n}\n\nexport default function ClientIsaOffer(props: ClientIsaOfferProps) {\n  const [isa, set_isa] = useState<any>(null)\n  const [offer_step, set_offer_step] = useState(0)\n  const [request_error, set_request_error] = useState('')\n\n  const isa_id = props.match.params.id\n\n  const getIsa = async () => {\n    try {\n      const res = await clientService.getOffer(isa_id)\n\n      if (res) {\n        if (res.error) {\n          set_offer_step(offer_step - 1)\n          set_request_error(res.error)\n          setTimeout(() => set_request_error(''), 3000)\n        } else {\n          set_isa(res)\n        }\n      }\n    } catch (e) {\n      set_request_error(e.error || e.toString())\n      setTimeout(() => set_request_error(''), 3000)\n    }\n  }\n\n  useLayoutEffect(() => {\n    getIsa()\n  }, [])\n\n  const onSuccess = async (token: string, metadata: PlaidMetadata) => {\n    try {\n      const res = await plaidService.createItem(token, metadata)\n\n      if (res) {\n        if (res.error || res.err_msg) {\n          set_offer_step(offer_step - 1)\n          set_request_error(res.error || res.err_msg)\n          setTimeout(() => set_request_error(''), 3000)\n        } else {\n          props.history.push(`/isa/${isa_id || 1}`)\n        }\n      }\n    } catch (e) {\n      set_offer_step(offer_step - 1)\n      set_request_error(e.error || e.toString())\n      setTimeout(() => set_request_error(''), 3000)\n    }\n  }\n\n  const handleSignUp = async () => {\n    set_offer_step(offer_step + 1)\n    await props.fetchUser()\n    open()\n  }\n\n  const config = {\n    clientName: 'Commit Muse',\n    env: 'sandbox',\n    product: ['auth', 'transactions'],\n    publicKey: 'a004a070f0629da694fbae916414f3',\n    onSuccess: onSuccess,\n  }\n\n  const { open, ready, error } = usePlaidLink(config)\n  const offer_strategy: any = isa && {\n    'review offer': (\n      <IsaOfferReview\n        isa={isa}\n        onNext={() => {\n          set_offer_step(offer_step + 1)\n        }}\n      />\n    ),\n    'sign up': isa && <ClientIsaSignUp email={isa.student.email} user_id={isa.student.id.toString()} onNext={handleSignUp} />,\n    'link bank': (\n      <section className=\"link_bank\">\n        <Button background=\"MainWarning\" onClick={() => open()}>\n          Link Bank\n        </Button>\n      </section>\n    ),\n  }\n\n  return (\n    <article className=\"ClientIsaOffer-page\">\n      <PageHeader />\n      <PageContent>\n        <section className=\"offer-steps\">\n          <OfferStatus statuses={offerStatuses} activeIndex={offer_step} />\n          {isa && offer_strategy[offerStatuses[offer_step]]}\n        </section>\n        {isa && <FAQ maximum={isa.cap} months={isa.time_to_be_paid} percentage={isa.percentage} current_income={isa.current_income} />}\n      </PageContent>\n      <Message message={request_error} />\n    </article>\n  )\n}"]},"metadata":{},"sourceType":"module"}