{"ast":null,"code":"import _objectSpread from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import'./style.scss';import PageContent from'../../../../modules/common/PageContent';import Input from'../../../../components/Input';import Icon from'../../../../components/Icon';import{validateEmail}from'../../../../../helpers/base';import{log}from'../../../../../services/logging.service';import AuthService from'../../../../../services/auth.service';import{emailErrorMessage,passwordLength}from'../../../../../constants/auth';import Button from'../../../../components/Button';import Message from'../../../../components/Message';import{Link}from'react-router-dom';var authService=new AuthService();export default function SignIn(props){var _useState=useState({email:'',password:''}),_useState2=_slicedToArray(_useState,2),user=_useState2[0],set_user=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],set_loading=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),request_error=_useState6[0],set_request_error=_useState6[1];var _useState7=useState({email:'',password:''}),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],set_error=_useState8[1];var notValid=function notValid(){return Object.values(user).some(function(i){return i==='';})||!validateEmail(user.email)||user.password.length<6;};var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:set_loading(true);_context.prev=1;_context.next=4;return authService.login(user);case 4:res=_context.sent;if(!res){_context.next=18;break;}if(!res.error){_context.next=10;break;}set_loading(false);set_request_error(res.error);return _context.abrupt(\"return\",setTimeout(function(){return set_request_error('');},3000));case 10:_context.next=12;return props.fetchUser();case 12:set_loading(false);if(!(res.user_role===1)){_context.next=17;break;}return _context.abrupt(\"return\",props.history.push('admin/users'));case 17:return _context.abrupt(\"return\",res.company?props.history.push('/company/dashboard'):props.history.push('/my-isa'));case 18:_context.next=26;break;case 20:_context.prev=20;_context.t0=_context[\"catch\"](1);set_loading(false);log('Error on sign in: ',_context.t0);set_request_error(_context.t0.error||_context.t0.toString);return _context.abrupt(\"return\",setTimeout(function(){return set_request_error('');},3000));case 26:case\"end\":return _context.stop();}}},_callee,null,[[1,20]]);}));return function onSubmit(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(\"article\",{className:\"SignIn-page\"},/*#__PURE__*/React.createElement(PageContent,null,/*#__PURE__*/React.createElement(\"h2\",null,\"Login\"),/*#__PURE__*/React.createElement(\"section\",{className:\"form\"},/*#__PURE__*/React.createElement(\"div\",{className:\"fields\"},/*#__PURE__*/React.createElement(Input,{icon:\"mail\",placeholder:\"Email Address\",error:error.email,value:user.email,onChange:function onChange(e){set_error(_objectSpread({},error,{email:''}));set_user(_objectSpread({},user,{email:e}));!validateEmail(e)&&set_error(_objectSpread({},error,{email:emailErrorMessage}));}}),/*#__PURE__*/React.createElement(Input,{icon:\"key\",placeholder:\"Password\",type:\"password\",error:error.password,value:user.password,onChange:function onChange(e){set_error(_objectSpread({},error,{password:''}));set_user(_objectSpread({},user,{password:e}));e.length<6&&set_error(_objectSpread({},error,{password:passwordLength}));}})),/*#__PURE__*/React.createElement(\"footer\",{className:\"full\"},/*#__PURE__*/React.createElement(\"p\",null,\"Don't have an account? \",/*#__PURE__*/React.createElement(Link,{to:\"/register\"},\"Sign Up\")),/*#__PURE__*/React.createElement(Button,{disabled:notValid(),onClick:onSubmit,loading:loading},\"Login \",/*#__PURE__*/React.createElement(Icon,{icon:\"arrow-right\"}),' ')))),request_error.length>0&&/*#__PURE__*/React.createElement(Message,{message:request_error}));}","map":{"version":3,"sources":["/Users/gilad/code/commitmuse/client/src/app/pages/public/auth/sign-in/index.tsx"],"names":["React","useState","PageContent","Input","Icon","validateEmail","log","AuthService","emailErrorMessage","passwordLength","Button","Message","Link","authService","SignIn","props","email","password","user","set_user","loading","set_loading","request_error","set_request_error","error","set_error","notValid","Object","values","some","i","length","onSubmit","login","res","setTimeout","fetchUser","user_role","history","push","company","toString","e"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport './style.scss'\nimport { ScreenProps } from '../../../../../interfaces/baseIntefaces'\nimport PageContent from '../../../../modules/common/PageContent'\nimport Input from '../../../../components/Input'\nimport Icon from '../../../../components/Icon'\nimport { validateEmail } from '../../../../../helpers/base'\nimport { log } from '../../../../../services/logging.service'\nimport AuthService from '../../../../../services/auth.service'\nimport { emailErrorMessage, passwordLength } from '../../../../../constants/auth'\nimport Button from '../../../../components/Button'\nimport Message from '../../../../components/Message'\nimport { Link } from 'react-router-dom'\n\nconst authService = new AuthService()\n\nexport default function SignIn(props: ScreenProps) {\n  const [user, set_user] = useState({\n    email: '',\n    password: '',\n  })\n\n  const [loading, set_loading] = useState(false)\n  const [request_error, set_request_error] = useState('')\n\n  const [error, set_error] = useState({\n    email: '',\n    password: '',\n  })\n\n  const notValid = () =>\n    Object.values(user).some(i => i === '') || !validateEmail(user.email) || user.password.length < 6\n\n  const onSubmit = async () => {\n    set_loading(true)\n    try {\n      const res = await authService.login(user)\n\n      if (res) {\n        if (res.error) {\n          set_loading(false)\n          set_request_error(res.error)\n          return setTimeout(() => set_request_error(''), 3000)\n        }\n\n        await props.fetchUser()\n        set_loading(false)\n\n        if (res.user_role === 1) {\n          return props.history.push('admin/users')\n        } else {\n          return res.company ? props.history.push('/company/dashboard') : props.history.push('/my-isa')\n        }\n      }\n    } catch (e) {\n      set_loading(false)\n      log('Error on sign in: ', e)\n      set_request_error(e.error || e.toString)\n      return setTimeout(() => set_request_error(''), 3000)\n    }\n  }\n\n  return (\n    <article className=\"SignIn-page\">\n      <PageContent>\n        <h2>Login</h2>\n        <section className=\"form\">\n          <div className=\"fields\">\n            <Input\n              icon=\"mail\"\n              placeholder=\"Email Address\"\n              error={error.email}\n              value={user.email}\n              onChange={e => {\n                set_error({ ...error, email: '' })\n                set_user({ ...user, email: e })\n                !validateEmail(e) && set_error({ ...error, email: emailErrorMessage })\n              }}\n            />\n            <Input\n              icon=\"key\"\n              placeholder=\"Password\"\n              type=\"password\"\n              error={error.password}\n              value={user.password}\n              onChange={e => {\n                set_error({ ...error, password: '' })\n                set_user({ ...user, password: e })\n                e.length < 6 && set_error({ ...error, password: passwordLength })\n              }}\n            />\n          </div>\n          <footer className=\"full\">\n            <p>\n              Don't have an account? <Link to=\"/register\">Sign Up</Link>\n            </p>\n\n            <Button disabled={notValid()} onClick={onSubmit} loading={loading}>\n              Login <Icon icon=\"arrow-right\" />{' '}\n            </Button>\n          </footer>\n        </section>\n      </PageContent>\n      {request_error.length > 0 && <Message message={request_error} />}\n    </article>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}