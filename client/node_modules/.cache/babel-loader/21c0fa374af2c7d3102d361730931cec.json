{"ast":null,"code":"import _regeneratorRuntime from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/gilad/code/commitmuse/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useLayoutEffect,useState}from'react';import'./style.scss';import currentEnv from'../../../../../config/environment';import{usePlaidLink}from'react-plaid-link';import IsaOfferReview from'../../../../modules/client/IsaOfferReview';import ClientIsaSignUp from'./sign-up';import Button from'../../../../components/Button';import PageContent from'../../../../modules/common/PageContent';import Stepper from'../../../../modules/common/Stepper';import ISACalculator from'../../../../modules/on-boarding/ISACalculator';import FAQ from'../../../../modules/company/CreateIsa/FAQ';import Message from'../../../../components/Message';import PlaidService from'../../../../../services/plaid.service';import ClientService from'../../../../../services/client.service';var plaidService=new PlaidService();var clientService=new ClientService();var offerStatuses=['review offer','sign up','link bank','sign contract'];export default function ClientIsaOfferSigning(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),isa=_useState2[0],set_isa=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),offer_step=_useState4[0],set_offer_step=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),request_error=_useState6[0],set_request_error=_useState6[1];var isa_id=props.match.params.id;var token=props.location.search.split('?token=')[1];var getIsa=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return clientService.getOffer(isa_id);case 3:res=_context.sent;if(res){if(res.error){set_offer_step(offer_step-1);set_request_error(res.error);setTimeout(function(){return set_request_error('');},3000);}else{set_isa(res);}}_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);set_request_error(_context.t0.error||_context.t0.toString());setTimeout(function(){return set_request_error('');},3000);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function getIsa(){return _ref.apply(this,arguments);};}();useLayoutEffect(function(){getIsa();},[]);var onSuccess=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(token,metadata){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return plaidService.createItem(token,metadata);case 3:res=_context2.sent;if(res){if(res.error||res.err_msg){set_offer_step(offer_step-1);set_request_error(res.error||res.err_msg);setTimeout(function(){return set_request_error('');},3000);}else{props.history.push(\"/isa/\".concat(isa_id||1));}}_context2.next=12;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);set_offer_step(offer_step-1);set_request_error(_context2.t0.error||_context2.t0.toString());setTimeout(function(){return set_request_error('');},3000);case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function onSuccess(_x,_x2){return _ref2.apply(this,arguments);};}();var handleSignUp=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:set_offer_step(offer_step+1);_context3.next=3;return props.fetchUser();case 3:open();case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSignUp(){return _ref3.apply(this,arguments);};}();var config={clientName:'Commit Muse',product:['auth','transactions'],env:currentEnv().PLAID_ENV,publicKey:currentEnv().PLAID_PUBLIC_KEY,onSuccess:onSuccess,token:props.plaid_token};var _usePlaidLink=usePlaidLink(config),open=_usePlaidLink.open,ready=_usePlaidLink.ready,error=_usePlaidLink.error;var offer_strategy=isa&&{'review offer':/*#__PURE__*/React.createElement(IsaOfferReview,{isa:isa,onNext:function onNext(){set_offer_step(offer_step+1);}}),'sign up':isa&&/*#__PURE__*/React.createElement(ClientIsaSignUp,{email:isa.student.email,user_id:isa.student.id.toString(),onNext:handleSignUp,token:token}),'link bank':/*#__PURE__*/React.createElement(\"section\",{className:\"link_bank\"},/*#__PURE__*/React.createElement(Button,{background:\"MainWarning\",onClick:function onClick(){return open();}},\"Link Bank\"))};return/*#__PURE__*/React.createElement(\"article\",{className:\"ClientIsaOfferSigning-page\"},/*#__PURE__*/React.createElement(PageContent,null,/*#__PURE__*/React.createElement(\"section\",{className:\"offer-steps\"},/*#__PURE__*/React.createElement(Stepper,{steps:offerStatuses,activeIndex:offer_step}),isa&&offer_strategy[offerStatuses[offer_step]]),isa&&/*#__PURE__*/React.createElement(\"section\",null,/*#__PURE__*/React.createElement(ISACalculator,{current_income:isa.current_income,percentage:isa.percentage,months:isa.time_to_be_paid,max:isa.cap}),/*#__PURE__*/React.createElement(FAQ,null))),/*#__PURE__*/React.createElement(Message,{message:request_error}));}","map":{"version":3,"sources":["/Users/gilad/code/commitmuse/client/src/app/pages/public/client/isa-offer-steps/index.tsx"],"names":["React","useLayoutEffect","useState","currentEnv","usePlaidLink","IsaOfferReview","ClientIsaSignUp","Button","PageContent","Stepper","ISACalculator","FAQ","Message","PlaidService","ClientService","plaidService","clientService","offerStatuses","ClientIsaOfferSigning","props","isa","set_isa","offer_step","set_offer_step","request_error","set_request_error","isa_id","match","params","id","token","location","search","split","getIsa","getOffer","res","error","setTimeout","toString","onSuccess","metadata","createItem","err_msg","history","push","handleSignUp","fetchUser","open","config","clientName","product","env","PLAID_ENV","publicKey","PLAID_PUBLIC_KEY","plaid_token","ready","offer_strategy","student","email","current_income","percentage","time_to_be_paid","cap"],"mappings":"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","sourcesContent":["import React, { useLayoutEffect, useState } from 'react'\nimport './style.scss'\nimport { PlaidMetadata, ScreenProps } from '../../../../../interfaces/baseIntefaces'\nimport currentEnv from '../../../../../config/environment'\nimport { usePlaidLink } from 'react-plaid-link'\nimport IsaOfferReview from '../../../../modules/client/IsaOfferReview'\nimport ClientIsaSignUp from './sign-up'\nimport Button from '../../../../components/Button'\nimport PageContent from '../../../../modules/common/PageContent'\nimport Stepper from '../../../../modules/common/Stepper'\nimport ISACalculator from '../../../../modules/on-boarding/ISACalculator'\nimport FAQ from '../../../../modules/company/CreateIsa/FAQ'\nimport Message from '../../../../components/Message'\nimport PlaidService from '../../../../../services/plaid.service'\nimport ClientService from '../../../../../services/client.service'\n\nconst plaidService = new PlaidService()\nconst clientService = new ClientService()\nconst offerStatuses = ['review offer', 'sign up', 'link bank', 'sign contract']\n\ninterface ClientIsaOfferSigningProps extends ScreenProps {\n  match: any\n}\n\nexport default function ClientIsaOfferSigning(props: ClientIsaOfferSigningProps) {\n  const [isa, set_isa] = useState<any>(null)\n  const [offer_step, set_offer_step] = useState(0)\n  const [request_error, set_request_error] = useState('')\n\n  const isa_id = props.match.params.id\n  const token = props.location.search.split('?token=')[1]\n\n  const getIsa = async () => {\n    try {\n      const res = await clientService.getOffer(isa_id)\n\n      if (res) {\n        if (res.error) {\n          set_offer_step(offer_step - 1)\n          set_request_error(res.error)\n          setTimeout(() => set_request_error(''), 3000)\n        } else {\n          set_isa(res)\n        }\n      }\n    } catch (e) {\n      set_request_error(e.error || e.toString())\n      setTimeout(() => set_request_error(''), 3000)\n    }\n  }\n\n  useLayoutEffect(() => {\n    getIsa()\n  }, [])\n\n  const onSuccess = async (token: string, metadata: PlaidMetadata) => {\n    try {\n      const res = await plaidService.createItem(token, metadata)\n\n      if (res) {\n        if (res.error || res.err_msg) {\n          set_offer_step(offer_step - 1)\n          set_request_error(res.error || res.err_msg)\n          setTimeout(() => set_request_error(''), 3000)\n        } else {\n          props.history.push(`/isa/${isa_id || 1}`)\n        }\n      }\n    } catch (e) {\n      set_offer_step(offer_step - 1)\n      set_request_error(e.error || e.toString())\n      setTimeout(() => set_request_error(''), 3000)\n    }\n  }\n\n  const handleSignUp = async () => {\n    set_offer_step(offer_step + 1)\n    await props.fetchUser()\n    open()\n  }\n\n  const config = {\n    clientName: 'Commit Muse',\n    product: ['auth', 'transactions'],\n    env: currentEnv().PLAID_ENV,\n    publicKey: currentEnv().PLAID_PUBLIC_KEY,\n    onSuccess: onSuccess,\n    token: props.plaid_token,\n  }\n\n  const { open, ready, error } = usePlaidLink(config)\n  const offer_strategy: any = isa && {\n    'review offer': (\n      <IsaOfferReview\n        isa={isa}\n        onNext={() => {\n          set_offer_step(offer_step + 1)\n        }}\n      />\n    ),\n    'sign up': isa && (\n      <ClientIsaSignUp\n        email={isa.student.email}\n        user_id={isa.student.id.toString()}\n        onNext={handleSignUp}\n        token={token}\n      />\n    ),\n    'link bank': (\n      <section className=\"link_bank\">\n        <Button background=\"MainWarning\" onClick={() => open()}>\n          Link Bank\n        </Button>\n      </section>\n    ),\n  }\n\n  return (\n    <article className=\"ClientIsaOfferSigning-page\">\n      <PageContent>\n        <section className=\"offer-steps\">\n          <Stepper steps={offerStatuses} activeIndex={offer_step} />\n          {isa && offer_strategy[offerStatuses[offer_step]]}\n        </section>\n\n        {isa && (\n          <section>\n            <ISACalculator\n              current_income={isa.current_income}\n              percentage={isa.percentage}\n              months={isa.time_to_be_paid}\n              max={isa.cap}\n            />\n            <FAQ />\n          </section>\n        )}\n      </PageContent>\n      <Message message={request_error} />\n    </article>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}